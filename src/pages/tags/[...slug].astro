---
import Page from "../../components/Page.astro";
import PostsList from "../../components/PostsList.astro";
import TagsList from "../../components/TagsList.astro";
import type { Post, Tag } from "../../interfaces/keystone";
import fetchApi, { getCollection } from "../../lib/keystone";

export async function getStaticPaths() {

  const { tags } = await fetchApi({
            queryGraphQL: `
            query Query {
                tags {
                id
                name 
                posts {
                id
                author {
                    name
                }
                content {
                    document
                }
                title
                pubDate
                description
                tags{
                    id
                    name
                  }
                }
                }
            } 
      `
        })
  return tags?.map((tag) => ({
    params: { slug: tag.id },
    props: tag,
  }));
}

type Props = Tag;

const tag = Astro.props;

---

<Page title="Welcome!" description="">
  <div>
    <div>
      <h1 class="text-3xl mt-2">Full Stack Developer</h1>
      <p class="text-lg mt-2">
        I'm Telecomunications Engineer, that pivoted into Software Development.
      </p>
    </div>

    <h1 class="text-3xl my-2">Some posts...</h1>
    <div class="flex">
      <div>
        <h4 class="text-xs my-2">Filter by topic</h4>
       <TagsList/> 
      </div>
      <PostsList posts={tag.posts} />
    </div>
  </div>
</Page>
